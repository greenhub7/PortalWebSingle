@{
    Layout = null;
}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Perinatal Forms - Test with Mock Data</title>
    
    <!-- Include all form CSS -->
    <link rel="stylesheet" href="~/css/perinatal-form1.css" />
    <link rel="stylesheet" href="~/css/perinatal-form2.css" />
    <link rel="stylesheet" href="~/css/perinatal-form1-fixes.css" />
    
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-header {
            background: #2196F3;
            color: white;
            padding: 15px;
            margin: -20px -20px 20px -20px;
            text-align: center;
        }
        .test-controls {
            background: white;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-controls button {
            padding: 10px 20px;
            margin: 5px;
            font-size: 14px;
            cursor: pointer;
            border: none;
            border-radius: 4px;
            background: #4CAF50;
            color: white;
        }
        .test-controls button:hover {
            background: #45a049;
        }
        .test-controls button.secondary {
            background: #2196F3;
        }
        .test-controls button.secondary:hover {
            background: #0b7dda;
        }
        .forms-container {
            background: white;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .page-break {
            page-break-after: always;
            margin: 40px 0;
            border-top: 2px dashed #ccc;
            padding-top: 40px;
        }
        @@media print {
            .test-header,
            .test-controls {
                display: none;
            }
            body {
                background: white;
                padding: 0;
            }
            .forms-container {
                box-shadow: none;
                padding: 0;
            }
            .page-break {
                border: none;
                margin: 0;
                padding: 0;
            }
        }
    </style>
</head>
<body>
    <div class="test-header">
        <h1>üß™ Perinatal Forms - Full Test with Mock Data</h1>
        <p>Testing all functionality with sample data (no database required)</p>
    </div>

    <div class="test-controls">
        <button onclick="populateMockData()">üìù Populate Mock Data</button>
        <button onclick="clearAllData()" class="secondary">üóëÔ∏è Clear All Data</button>
        <button onclick="window.print()" class="secondary">üñ®Ô∏è Print Preview</button>
        <button onclick="validateAllFields()" class="secondary">‚úÖ Validate Fields</button>
    </div>

    <div class="forms-container">
        <!-- Form 1: Front Side (Anverso) -->
        <div id="form1-container">
            @await Html.PartialAsync("_Form1")
        </div>

        <!-- Page Break -->
        <div class="page-break"></div>

        <!-- Form 2: Back Side (Reverso) -->
        <div id="form2-container">
            @await Html.PartialAsync("_Form2")
        </div>
    </div>

    <!-- Include all form JavaScript -->
    <script src="~/js/perinatal/print/print-form-controls.js"></script>
    <script src="~/js/perinatal/print/print-form1.js"></script>
    <script src="~/js/perinatal/print/print-form2.js"></script>

    <script>
        // Mock data for testing
        const mockData = {
            success: true,
            id: 1,
            createdDate: "2024-01-15T10:30:00",
            
            // Patient information
            patient: {
                patientId: 12345,
                age: "28",
                person: {
                    firstName: "Mar√≠a",
                    lastName: "Gonz√°lez P√©rez",
                    bornDate: "1995-06-15T00:00:00",
                    address: "Calle Principal #123, Santo Domingo",
                    cel: "809-555-1234",
                    tel: "809-555-5678",
                    identityNumber: "001-1234567-8",
                    maritalSituation: {
                        name: "Casada"
                    },
                    schoolLevel: {
                        name: "Universitaria"
                    },
                    country: {
                        name: "Rep√∫blica Dominicana"
                    }
                }
            },

            // Prenatal control and birth locations
            prenatalControlLocation: "Hospital Materno Infantil San Lorenzo",
            birthLocation: "Hospital Regional Dr. Antonio Musa",

            // Medical background
            medicalBackground: {
                familyTuberculosis: 2, // No
                familyDiabetes: 1, // Yes
                familyHypertension: 1, // Yes
                familyPreeclampsia: 2, // No
                familyEclampsia: 2, // No
                familyOther: 2, // No
                personalTuberculosis: 2, // No
                personalDiabetes: 2, // No
                personalHypertension: 2, // No
                personalPreeclampsia: 2, // No
                personalEclampsia: 2, // No
                personalGenitourinarySurgery: 2, // No
                personalInfertility: 2, // No
                personalHeartDisease: 2, // No
                personalKidneyDisease: 2, // No
                personalViolence: 2, // No
                personalHIV: 2 // No
            },

            // Obstetric background
            obstetricBackground: {
                previousPregnancies: 2,
                totalDeliveries: 1,
                vaginalDeliveries: 1,
                cesareanDeliveries: 0,
                abortions: 0,
                living: 1,
                deadFirstWeek: 0,
                deadAfterFirstWeek: 0,
                lastPregnancyEndDate: "2022-03-20T00:00:00",
                twins: 2, // No
                threeOrMoreAbortions: 2 // No
            },

            // Current pregnancy
            currentPregnancy: {
                prePregnancyWeight: 65,
                height: 162,
                lastMenstrualPeriod: "2023-10-01T00:00:00",
                estimatedDueDate: "2024-07-08T00:00:00",
                reliableGestationalAge: 1, // Yes
                smoker: 2, // No
                drugs: 2, // No
                alcohol: 2, // No
                tetanusVaccine: "2 dosis",
                dentalExam: 1, // Yes
                breastExam: 1, // Yes
                bloodGroup: "O",
                rhFactor: "Positivo",
                rhSensitized: 2, // No
                toxoplasmosis: "Negativo",
                hiv: "Negativo",
                hemoglobin1: "12.5",
                hemoglobin2: "11.8",
                vdrl1: "No reactivo",
                vdrl2: "No reactivo",
                chagas: "Negativo",
                malaria: "Negativo",
                bacteriuria: "Negativo",
                glycemia: "85",
                streptococcusB: "Negativo",
                papSmear: "Normal",
                colposcopy: "Normal",
                ironFolicAcid: 1 // Yes
            },

            // Prenatal consultations
            prenatalConsultations: [
                {
                    id: 1,
                    date: "2023-11-15T00:00:00",
                    gestationalAge: 6,
                    weight: 66,
                    bloodPressure: "110/70",
                    uterineHeight: 0,
                    presentation: "",
                    fetalHeartRate: 0,
                    fetalMovements: 2,
                    proteinuria: 0,
                    warningSign: false,
                    initials: "DRA"
                },
                {
                    id: 2,
                    date: "2023-12-20T00:00:00",
                    gestationalAge: 11,
                    weight: 67,
                    bloodPressure: "115/72",
                    uterineHeight: 11,
                    presentation: "",
                    fetalHeartRate: 145,
                    fetalMovements: 1,
                    proteinuria: 0,
                    warningSign: false,
                    initials: "DRA"
                },
                {
                    id: 3,
                    date: "2024-01-25T00:00:00",
                    gestationalAge: 16,
                    weight: 69,
                    bloodPressure: "112/70",
                    uterineHeight: 16,
                    presentation: "Cef√°lica",
                    fetalHeartRate: 148,
                    fetalMovements: 1,
                    proteinuria: 0,
                    warningSign: false,
                    initials: "DRA"
                }
            ],

            // Birth information
            birthInformation: {
                admissionDate: "2024-07-05T00:00:00",
                birthDate: "2024-07-06T00:00:00",
                birthTime: "14:30",
                gestationalAgeAtBirthWeeks: 39,
                gestationalAgeAtBirthDays: 2,
                spontaneousOnset: 1, // Yes
                inducedOnset: 2, // No
                membraneRupture: "Espont√°nea",
                cephalicPresentation: 1, // Yes
                pelvicPresentation: 2, // No
                transverseSituation: 2, // No
                positionVariety: "OIA",
                spontaneousBirth: 1, // Yes
                forcepsBirth: 2, // No
                vacuumBirth: 2, // No
                cesareanBirth: 2, // No
                indication: "",
                companion: 1, // Yes
                episiotomy: 2, // No
                tear: 2, // No
                tearGrade: "",
                manualRemovalOfPlacenta: 2, // No
                cordClampingTime: "2 minutos",
                oxytocicsInLabor: 2 // No
            },

            // Newborn information
            newbornInformation: {
                sex: "Femenino",
                birthWeight: 3250,
                length: 49,
                headCircumference: 34,
                gestationalAgeWeeks: 39,
                gestationalAgeDays: 2,
                gestationalAgeMethod: "FUM",
                weightForGestationalAge: "Adecuado",
                apgarFirstMinute: 9,
                apgarFifthMinute: 10,
                resuscitationStimulation: 1, // Yes
                resuscitationAspiration: 2, // No
                resuscitationMask: 2, // No
                resuscitationOxygen: 2, // No
                resuscitationIntubation: 2, // No
                resuscitationMassage: 2, // No
                resuscitationMedication: 2, // No
                birthDefectsType: "",
                birthDefectsCode: "",
                earlyBreastfeedingInitiation: 1 // Yes
            },

            // Postpartum information
            postpartumInformation: {
                antiDGlobulin: "No aplica"
            },

            // Morbidity information
            morbidityInformation: {
                chronicHypertension: 2,
                gestationalHypertension: 2,
                mildPreeclampsia: 2,
                severePreeclampsia: 2,
                eclampsia: 2,
                hellp: 2,
                sepsis: 2,
                pyelonephritis: 2,
                gestationalDiabetes: 2,
                anemia: 2,
                polyhydramnios: 2,
                oligohydramnios: 2,
                intrauterineGrowthRestriction: 2,
                prolongedRuptureOfMembranes: 2,
                postpartumHemorrhage: 2
            },

            // Near-miss variables
            nearMissVariables: {
                shock: 2,
                cardiacArrest: 2,
                jaundiceInPreeclampsia: 2,
                acuteCyanosis: 2,
                gasping: 2,
                severeTachypnea: 2,
                severeBradypnea: 2,
                oliguriaUnresponsiveToFluidsOrDiuretics: 2,
                coagulationDisorders: 2,
                coma: 2,
                prolongedUnconsciousness: 2,
                strokeOrCVA: 2,
                uncontrollableSeizuresOrStatusEpilepticus: 2,
                generalizedParalysis: 2,
                plateletsLessThan50000: 2,
                creatinineGreaterOrEqual300: 2,
                bilirubinGreaterThan100: 2,
                pHLessThan7_1: 2,
                hemoglobinSaturationLessThan90PercentForOverOneHour: 2,
                lactateGreaterThan5: 2,
                continuousVasoactiveAgentsAdministration: 2,
                intubationAndVentilationNotRelatedToAnesthesia: 2,
                bloodProductsAdministrationGreaterOrEqualThreeUnits: 2,
                iCUAdmissionLessThanSevenDays: 2,
                hysterectomy: 2,
                dialysisForAcuteRenalFailure: 2,
                cardiopulmonaryResuscitation: 2
            },

            // Puerperium information
            puerperiumInformation: {
                days: [
                    { dayNumber: 1, dayLabel: "1", temperature: 36.8, bloodPressure: "120/75", pulse: 78, uterineInvolution: "Normal", lochia: "Rubra", breastfeeding: "S√≠", responsible: "ENF" },
                    { dayNumber: 2, dayLabel: "2", temperature: 36.7, bloodPressure: "118/72", pulse: 76, uterineInvolution: "Normal", lochia: "Rubra", breastfeeding: "S√≠", responsible: "ENF" },
                    { dayNumber: 3, dayLabel: "3", temperature: 36.9, bloodPressure: "115/70", pulse: 74, uterineInvolution: "Normal", lochia: "Serosa", breastfeeding: "S√≠", responsible: "ENF" }
                ]
            },

            // Maternal discharge information
            maternalDischargeInformation: {
                dischargeDate: "2024-07-08T00:00:00",
                dischargeTime: "10:00",
                dischargeCondition: "Viva",
                dischargeType: "Alta",
                transferred: 2, // No
                dischargeLocation: "",
                diedDuringOrInTransferLocation: "",
                autopsy: 2, // No
                responsiblePerson: "Dr. Ram√≠rez"
            },

            // Contraception information
            contraceptionInformation: {
                oralCounseling: 1, // Yes
                writtenCounseling: 1, // Yes
                noCounseling: 2, // No
                contraceptionMethodInitiated: 1, // Yes
                oralContraceptivesPreferred: 2,
                otherHormonalMethodsPreferred: 2,
                iUDPreferred: 1, // Yes
                injectablePreferred: 2,
                implantPreferred: 2,
                barrierPreferred: 2,
                condomPreferred: 2,
                femaleSterilizationPreferred: 2,
                maleSterilizationPreferred: 2,
                naturalMethodPreferred: 2,
                oralContraceptivesAccepted: 2,
                otherHormonalMethodsAccepted: 2,
                iUDAccepted: 1, // Yes
                injectableAccepted: 2,
                implantAccepted: 2,
                barrierAccepted: 2,
                condomAccepted: 2,
                femaleSterilizationAccepted: 2,
                maleSterilizationAccepted: 2,
                naturalMethodAccepted: 2,
                responsiblePerson: "Dra. Mart√≠nez"
            }
        };

        // Populate forms with mock data
        function populateMockData() {
            console.log('[TEST] Populating forms with mock data...');
            
            // Initialize radio groups first
            if (typeof initializeRadioGroups === 'function') {
                initializeRadioGroups();
            }

            // Populate Form 1
            if (typeof PerinatalPrintForm1 !== 'undefined') {
                PerinatalPrintForm1.populate(mockData);
                console.log('[TEST] Form 1 populated');
            } else {
                console.error('[TEST] PerinatalPrintForm1 not found');
            }

            // Populate Form 2
            if (typeof PerinatalPrintForm2 !== 'undefined') {
                PerinatalPrintForm2.populate(mockData);
                console.log('[TEST] Form 2 populated');
            } else {
                console.error('[TEST] PerinatalPrintForm2 not found');
            }

            alert('‚úÖ Mock data populated successfully!\n\nCheck the forms below to verify all fields are filled correctly.');
        }

        // Clear all form data
        function clearAllData() {
            if (confirm('Are you sure you want to clear all form data?')) {
                // Clear all inputs
                document.querySelectorAll('input[type="text"], input[type="number"]').forEach(input => {
                    input.value = '';
                });

                // Uncheck all radios
                document.querySelectorAll('input[type="radio"]').forEach(radio => {
                    radio.checked = false;
                });

                // Uncheck all checkboxes
                document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                    checkbox.checked = false;
                });

                console.log('[TEST] All form data cleared');
                alert('üóëÔ∏è All form data cleared');
            }
        }

        // Validate all fields
        function validateAllFields() {
            let report = {
                form1: {
                    totalFields: 0,
                    filledFields: 0,
                    emptyFields: 0
                },
                form2: {
                    totalFields: 0,
                    filledFields: 0,
                    emptyFields: 0
                }
            };

            // Count Form 1 fields
            document.querySelectorAll('#form1-container input[type="text"], #form1-container input[type="number"]').forEach(input => {
                report.form1.totalFields++;
                if (input.value && input.value.trim() !== '') {
                    report.form1.filledFields++;
                } else {
                    report.form1.emptyFields++;
                }
            });

            // Count Form 2 fields
            document.querySelectorAll('#form2-container input[type="text"], #form2-container input[type="number"]').forEach(input => {
                report.form2.totalFields++;
                if (input.value && input.value.trim() !== '') {
                    report.form2.filledFields++;
                } else {
                    report.form2.emptyFields++;
                }
            });

            const message = `üìä Field Validation Report\n\n` +
                `Form 1 (Front):\n` +
                `  Total Fields: ${report.form1.totalFields}\n` +
                `  Filled: ${report.form1.filledFields}\n` +
                `  Empty: ${report.form1.emptyFields}\n\n` +
                `Form 2 (Back):\n` +
                `  Total Fields: ${report.form2.totalFields}\n` +
                `  Filled: ${report.form2.filledFields}\n` +
                `  Empty: ${report.form2.emptyFields}\n\n` +
                `Total Fields: ${report.form1.totalFields + report.form2.totalFields}\n` +
                `Total Filled: ${report.form1.filledFields + report.form2.filledFields}`;

            alert(message);
            console.log('[TEST] Validation report:', report);
        }

        // Auto-populate on page load
        window.addEventListener('DOMContentLoaded', function() {
            console.log('[TEST] Page loaded, ready for testing');
            
            // Show instructions
            setTimeout(() => {
                if (confirm('üß™ Welcome to the Perinatal Forms Test Page!\n\nWould you like to automatically populate the forms with mock data?')) {
                    populateMockData();
                }
            }, 500);
        });
    </script>
</body>
</html>

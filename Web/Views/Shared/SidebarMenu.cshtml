@using Microsoft.AspNetCore.Html
@using System.Security.Claims
@inject Web.Services.MenuService MenuService

@{
    var menuOptions = await MenuService.GetMenuOptionsAsync(User.FindFirstValue(ClaimTypes.NameIdentifier),true); 
}

<div class="app-sidebar-menu overflow-hidden flex-column-fluid">
    <div id="kt_app_sidebar_menu_wrapper" class="app-sidebar-wrapper hover-scroll-overlay-y my-5" data-kt-scroll="true" data-kt-scroll-activate="true" data-kt-scroll-height="auto" data-kt-scroll-dependencies="#kt_app_sidebar_logo, #kt_app_sidebar_footer" data-kt-scroll-wrappers="#kt_app_sidebar_menu" data-kt-scroll-offset="5px" data-kt-scroll-save-state="true">
        <div class="menu menu-column menu-rounded menu-sub-indention px-3" id="#kt_app_sidebar_menu" data-kt-menu="true" data-kt-menu-expand="false">
            @if (menuOptions.Any())
            {
                @foreach (var option in menuOptions)
                {
                    <div class="menu-item">
                        <a class="menu-link" href="@Url.Action(option.Action, option.Controller)">
                            <span class="menu-icon">
                                <span class="svg-icon svg-icon-2">
                                    @Html.Raw(option.Icon)
                                </span>
                            </span>
                            <span class="menu-title">@option.Name</span>
                        </a>
                        @RenderSubMenu(menuOptions, option.OptionId)
                    </div>
                }
            }
            else
            {
                <div class="alert alert-warning">
                    No tienes opciones disponibles en tu plan actual.
                </div>
            }
        </div>
    </div>
</div>
@functions {
    private IHtmlContent RenderSubMenu(List<Option> menuOptions, int parentId)
    {
        var subMenuItems = menuOptions.Where(o => o.ParentOptionId == parentId).ToList();
        if (subMenuItems.Any())
        {
            <div class="menu-sub">
                @foreach (var subItem in subMenuItems)
                {
                    <div class="menu-item">
                        <a class="menu-link" href="@Url.Action(subItem.Action, subItem.Controller)">
                            <span class="menu-icon">
                                <span class="svg-icon svg-icon-2">
                                    @Html.Raw(subItem.Icon)
                                </span>
                            </span>
                            <span class="menu-title">@subItem.Name</span>
                        </a>
                    </div>
                }
            </div>
        }
        return Html.Raw("");
    }
}
